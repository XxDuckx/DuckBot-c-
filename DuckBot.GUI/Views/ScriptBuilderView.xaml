<UserControl x:Class="DuckBot.GUI.Views.ScriptBuilderView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <StackPanel Orientation="Horizontal" Margin="0,0,0,12" HorizontalAlignment="Stretch">
            <ComboBox x:Name="GameSelect" Width="200" Margin="0,0,12,0"
                      ToolTip="Select the game whose scripts you want to edit"
                      SelectionChanged="GameSelect_SelectionChanged"/>
            <ComboBox x:Name="ScriptSelect" Width="260" Margin="0,0,12,0"
                      ToolTip="Choose an existing script to load"
                      SelectionChanged="ScriptSelect_SelectionChanged"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="New" Width="90" Margin="0,0,8,0" Click="New_Click"/>
                <Button Content="Save" Width="90" Margin="0,0,8,0" Click="Save_Click"/>
                <Button Content="Save As" Width="110" Margin="0,0,8,0" Click="SaveAs_Click"/>
                <Button Content="Export JS" Width="130" Margin="0,0,8,0" Click="Export_Click"/>
                <Button Content="Test Run" Width="130" Margin="0,0,8,0" Click="TestRun_Click"/>
                <Button Content="Capture Screenshot" Width="190" Margin="0,0,8,0" Click="Capture_Click"/>
                <Button Content="Pick Coordinates" Width="170" Click="PickCoords_Click"/>
            </StackPanel>
        </StackPanel>

        <!-- Main Panels -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- Actions Library -->
            <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}" Padding="12" Margin="0,0,12,0">
                <DockPanel>
                    <TextBlock Text="Action Templates" FontWeight="Bold" DockPanel.Dock="Top" Margin="0,0,0,12"/>
                    <ListBox x:Name="ActionsLibrary" MouseDoubleClick="ActionsLibrary_DoubleClick"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             AllowDrop="False">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding DisplayName}" FontSize="13" Margin="2"
                                           TextWrapping="Wrap" ToolTip="{Binding Description}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <ListBox.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.HeaderTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="12" Margin="0,8,0,4"/>
                                    </DataTemplate>
                                </GroupStyle.HeaderTemplate>
                                <GroupStyle.Panel>
                                    <ItemsPanelTemplate>
                                        <StackPanel />
                                    </ItemsPanelTemplate>
                                </GroupStyle.Panel>
                            </GroupStyle>
                        </ListBox.GroupStyle>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- Step Sequence -->
            <Border Grid.Column="1" Background="{StaticResource SurfaceBrush}" Padding="12" Margin="0,0,12,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,12">
                        <TextBlock Text="Sequence" FontWeight="Bold" Margin="0,0,8,0"/>
                        <Button Content="Remove" Width="90" Margin="0,0,8,0" Click="RemoveStep_Click"/>
                        <Button Content="Move Up" Width="100" Margin="0,0,8,0" Click="MoveUp_Click"/>
                        <Button Content="Move Down" Width="110" Click="MoveDown_Click"/>
                    </StackPanel>
                    <ListBox x:Name="StepSequence" DisplayMemberPath="Summary"
                             SelectionChanged="StepSequence_SelectionChanged"
                             AllowDrop="True"
                             PreviewMouseLeftButtonDown="StepSequence_PreviewMouseLeftButtonDown"
                             PreviewMouseMove="StepSequence_PreviewMouseMove"
                             Drop="StepSequence_Drop"/>
                </DockPanel>
            </Border>

            <!-- Step Inspector -->
            <Border Grid.Column="2" Background="{StaticResource SurfaceBrush}" Padding="16">
                <StackPanel x:Name="Inspector">
                    <TextBlock Text="Step Inspector" FontWeight="Bold" Margin="0,0,0,12"/>
                    <StackPanel x:Name="InspectorContent"/>
                    <Separator Margin="0,16,0,16"/>
                    <StackPanel Orientation="Vertical" x:Name="VariableEditor">
                        <TextBlock Text="Variables" FontWeight="Bold" Margin="0,0,0,8"/>
                        <StackPanel x:Name="VariablesHost"/>
                        <Button Content="Add Variable" Margin="0,12,0,0" Width="140" Click="AddVariable_Click"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <TextBlock Grid.Row="2" x:Name="StatusText" Foreground="{StaticResource TextMutedBrush}" Margin="0,12,0,0"/>
    </Grid>
</UserControl>